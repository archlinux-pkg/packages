# Maintainer: MedzikUser <nivua1fn@duck.com>
pkgname='stripe-cli'
pkgver='1.10.1'
pkgrel=1
pkgdesc='Modern and easy to use SQL client for MySQL, Postgres, SQLite, SQL Server, and more'
arch=('x86_64')
url='https://stripe.com/docs/stripe-cli'
license=('GPL3')

depends=('glibc')
makedepends=('go' 'git')

source=("https://github.com/stripe/stripe-cli/archive/v$pkgver.tar.gz"
        'reproducible-image-flags.patch')
sha512sums=('63efd38be713a7556ebc82fd8927d82c41e76ddc96f75f6cfef60fdecce4ca46818b15b4535dabc0a5c636b62ef4fd943600ed6a5dfb1a3a09e01d2a8120f9b7'
            '4f5ff8662f5e4bce1ded88a055e652c41dd6492cda5aee74795752abf0e97cc269ec1fef84df2247f62809f0c8cc1a88dd12104e07090cc224bbc5ad46b33f37')

prepare() {
  cd "$pkgname-$pkgver"

  # Add reproducible image flags
  patch -Np0 < ../reproducible-image-flags.patch

  make setup
}

build() {
  cd "$pkgname-$pkgver"
  make build
}

check() {
  cd "$pkgname-$pkgver"
  make test
}

package() {
  cd "$pkgname-$pkgver"
  install -Dm 755 stripe -t "$pkgdir/usr/bin"
  install -Dm 644 README.md -t "$pkgdir/usr/share/doc/$pkgname"
  cp -a docs "$pkgdir/usr/share/doc/$pkgname"
}
